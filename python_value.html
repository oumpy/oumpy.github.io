<!DOCTYPE html>
<html lang="ja">
<head>
          <title>大阪大学医学部Python会 - Pythonの変数と代入について</title>
        <meta charset="utf-8" />




    <meta name="tags" content="python" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">大阪大学医学部Python会 <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/category/atcoder.html">atcoder</a></li>
            <li><a href="/category/bioinformatics.html">bioinformatics</a></li>
            <li><a href="/category/deeplearning.html">deeplearning</a></li>
            <li><a href="/category/github.html">github</a></li>
            <li><a href="/category/kaggle.html">kaggle</a></li>
            <li><a href="/category/member.html">member</a></li>
            <li><a href="/category/paper.html">paper</a></li>
            <li class="active"><a href="/category/python.html">python</a></li>
            <li><a href="/category/shell.html">shell</a></li>
            <li><a href="/category/statistics.html">statistics</a></li>
            <li><a href="/category/tong-ji.html">統計</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/python_value.html" rel="bookmark"
         title="Permalink to Pythonの変数と代入について">Pythonの変数と代入について</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2019-04-14T00:00:00+09:00">
      日 14 4月 2019
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/xiao-chuan.html">小川</a>
    </address>
    <div class="category">
        Category: <a href="/category/python.html">python</a>
    </div>
    <div class="tags">
        Tags:
            <a href="/tag/python.html">python</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Pythonの変数、ふだん何気なく使っていますが、やっていることは実は結構複雑です。主にC/C++と対比しつつ簡単にまとめてみます。</p>
<p>実際のところ、よく知らなくてもあまり影響がない場合が殆どです。が、複雑な操作を行ったり何か変数の挙動が不審な場合などは、思い出してみるのもよさそうです。</p>
<h2>変数は参照である</h2>
<p>一言でいえば表題の通り。
Pythonでの<strong>変数への代入とは、変数の参照するメモリ（インスタンス）を切り替えること</strong>であり、<strong>メモリの内容を書き換えることではない</strong>。これが多くの言語（C/C++など）と大きく違うところです。</p>
<h2>変数の代入(1)</h2>
<p>例えばこんなコード。</p>
<div class="highlight"><pre><span></span><span class="c1"># Python3</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># 1を出力</span>
</pre></div>


<p>C++で書き換えると、</p>
<div class="highlight"><pre><span></span><span class="c1">// C++</span>
<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>  <span class="c1">// 1を出力</span>
</pre></div>


<p>なのか？？
（#include\とかint main(void){...}とかは全部省略。）  </p>
<p><strong>実は違う</strong>のです。<br>
C++の方では<code>a</code>で表されるメモリ領域を一つ確保し、そこにまず<code>0</code>をセット、次に<code>1</code>を、<strong>同じメモリ領域を書き換えて</strong>セットしています。  </p>
<p>Pythonの方はそうではありません。まず<code>0</code>の値を持つメモリ領域を確保し、<strong>変数<code>a</code>がそこを指すように</strong>します。次に<code>1</code>の値を持つ<strong>別のメモリ領域を確保</strong>し、変数<code>a</code>がそこを指すように切り替えます。</p>
<p>C++で無理矢理それっぽいものを書くと、</p>
<div class="highlight"><pre><span></span><span class="c1">// C++</span>
<span class="kt">int</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>  <span class="c1">// 1を出力</span>
</pre></div>


<p>のようになります。<br>
（C++に参照定数はあるが参照変数がないため、ポインタで書いた。）</p>
<p>実はこのC++コード、2行目で確保した<code>int(0)</code>メモリを3行目の<code>int(1)</code>代入時に<strong>放棄</strong>していて、<strong>メモリリーク</strong>が起こっています。C++では、これを処理（メモリ解放）するためのコードを本当は書き加えないといけません。<br>
しかし、Pythonではそれを<strong>ガベージコレクタ</strong>という仕組みが<strong>勝手に代行</strong>してくれます。逆にこれがないと、Pythonではメモリリークが頻繁に起こって大変なことになります。</p>
<h2>変数の代入(2)</h2>
<p>問題です。次のコードは何を出力するでしょうか。</p>
<div class="highlight"><pre><span></span><span class="c1"># Python3</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># 何が出る？</span>
</pre></div>


<p><strong>答えは「<code>0</code>」</strong>です。<br>
C++で書いた似たようなコード、</p>
<div class="highlight"><pre><span></span><span class="c1">// C++</span>
<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>  <span class="c1">// 出力は「0」</span>
</pre></div>


<p>も結果は同じなのですが、内部動作は全く異なります。<strong>Pythonでの変数代入は参照の切り替え</strong>であることがやはりポイントです。</p>
<p>一方で、過程は違えどPythonもC++も結果は変わりません。<strong>気にしなくても大抵はうまくいく</strong>、というのも大事なところです(笑)。</p>
<h2>関数引数はすべて参照渡し</h2>
<p>「変数が全て参照」であることから、関数引数もまた<strong>参照渡し</strong>となります。C/C++のデフォルトである<strong>値渡し</strong>と異なり、メモリのコピーなどは行われません。</p>
<p>では再び問題。次のコードは何を出力するでしょう？</p>
<div class="highlight"><pre><span></span><span class="c1"># Python3</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># ここまで。このprint()は何を出力するか？0？1？</span>
</pre></div>


<p>「参照渡し」を知っている人ほど、「1」と答えたくなりそうですが、、  </p>
<p><strong>答えは「0」</strong>です。何故か？<br>
<code>func(a)</code>を呼び出した時点では、<strong><code>a</code>と<code>x</code>の指すメモリは同じ<code>0</code></strong>ですが、<code>x = 1</code>で<code>x</code>の指すメモリは<strong>別に確保された<code>1</code></strong>に切り替わります。<strong><code>a</code>および、<code>a</code>の指す<code>0</code>には何の変化も無い</strong>のです。このあたりは前項の問題とほとんど同じです。</p>
<h2>「変数への代入」ではない場合</h2>
<p>例えばこんなとき。</p>
<div class="highlight"><pre><span></span><span class="c1"># Python3</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># 出力は[2,1]</span>
</pre></div>


<p>3行目で<code>b</code>と<code>a</code>は同じリストを参照するようになります。4行目では、そのリスト（これも参照の列みたいなもの）の最初の成分を、<code>0</code>でなく<code>2</code>のメモリを参照するように切り替えます。全体として見れば<code>a</code>と<code>b</code>が同じリストを参照していることに変わりはないので、この変更は<code>b</code>にも反映されています。</p>
<p>これは、前項の関数引数で若干の問題を引き起こします。<br>
次のコード、前項で見たものにそっくりですが、、、</p>
<div class="highlight"><pre><span></span><span class="c1"># Python3</span>
<span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">func2</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>


<p><strong>前項とは違い、この出力は「<code>1</code>」</strong>です。<br>
関数が呼び出されると<strong><code>a</code>と<code>x</code>の指すリストは一貫して同じ</strong>で、その一部が書き換えられるからです。これは<strong>リストでなくnumpy配列の場合もほぼ同じ</strong>です。</p>
<h2>まとめ</h2>
<p>以上見てきたように、Pythonの変数は全て参照、関数引数は全て参照渡しです。これらが組み合わさると、結果的に全てを値渡しにした場合（C/C++）と殆ど違いが見えなくなり、あまり意識することなくプログラムを書けるようになっています。</p>
<p>しかし、リストや配列（や、もっと複雑なクラスオブジェクトなど）のように部分的に書き換え可能なものを扱う場合などには、この違いはかなり重要になってきます。怪しいと思ったら、各変数が何を参照しているか、互いに同じか違うかなどを、その都度考えてみてください。</p>
<p>ひとまず今回はここまで。おしまい。
※画像は<a href="https://www.python.org/">公式</a>のものです。</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>